--- configure.ac.old	2011-12-08 01:55:01.000000000 -0500
+++ configure.ac	2015-02-17 12:20:18.811396038 -0500
@@ -810,7 +810,9 @@ dnl check for kernel headers required by
 dnl
 if test "$with_qemu" = "yes" || test "$with_lxc" = "yes" ; then
   AC_CHECK_HEADERS([linux/param.h linux/sockios.h linux/if_bridge.h linux/if_tun.h],,
-                   AC_MSG_ERROR([You must install kernel-headers in order to compile libvirt with QEMU or LXC support]))
+    [AC_MSG_ERROR([You must install kernel-headers in order to compile libvirt with QEMU or LXC support])],
+    [[#include <netinet/in.h>
+  ]])
 fi
 
 
@@ -2480,7 +2482,7 @@ AM_CONDITIONAL([WITH_VIRTUALPORT], [test
 dnl netlink library
 
 LIBNL_CFLAGS=""
-LIBNL_LIBS=""
+LIBNL_LIBS=$old_LIBS
 have_libnl=no
 
 if test "$with_linux" = "yes"; then
