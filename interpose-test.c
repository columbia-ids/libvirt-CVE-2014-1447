#define _GNU_SOURCE
#define GNULIB_NAMESPACE
#define HAVE_GETUID
#define HAVE_GETEUID
#define HAVE_GETGID
#define HAVE_PTHREAD_MUTEXATTR_INIT
#include <dlfcn.h>
#include <unistd.h>
#include <sys/types.h>
#include <stdbool.h>
#include <sys/time.h>
#include <pthread.h>
#include <dirent.h>
#include <stdio.h>
#include <wchar.h>
#include <libintl.h>
#include <signal.h>

char *setlocale(int category, const char * locale)
{
	static char * (*real_setlocale)(int, const char *) = NULL;
	int i;
	for(i=0; i<17; i++)
		asm("nop;");
	if(!real_setlocale)
		real_setlocale = dlsym(RTLD_NEXT, "setlocale");
	return real_setlocale(category, locale);
}

int fclose(FILE * stream)
{
	static int (*real_fclose)(FILE *) = NULL;
	int i;
	for(i=0; i<11; i++)
		asm("nop;");
	if(!real_fclose)
		real_fclose = dlsym(RTLD_NEXT, "fclose");
	return real_fclose(stream);
}

int fflush(FILE * stream)
{
	static int (*real_fflush)(FILE *) = NULL;
	int i;
	for(i=0; i<32; i++)
		asm("nop;");
	if(!real_fflush)
		real_fflush = dlsym(RTLD_NEXT, "fflush");
	return real_fflush(stream);
}

int setvbuf(FILE * stream, char * buf, int mode, size_t size)
{
	static int (*real_setvbuf)(FILE *, char *, int, size_t) = NULL;
	int i;
	for(i=0; i<29; i++)
		asm("nop;");
	if(!real_setvbuf)
		real_setvbuf = dlsym(RTLD_NEXT, "setvbuf");
	return real_setvbuf(stream, buf, mode, size);
}

long int strtol(const char * nptr, char ** endptr, int base)
{
	static long int (*real_strtol)(const char *, char **, int) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_strtol)
		real_strtol = dlsym(RTLD_NEXT, "strtol");
	return real_strtol(nptr, endptr, base);
}

void free(void * ptr)
{
	static void (*real_free)(void *) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_free)
		real_free = dlsym(RTLD_NEXT, "free");
	return real_free(ptr);
}

void *realloc(void * ptr, size_t size)
{
	static void * (*real_realloc)(void *, size_t) = NULL;
	int i;
	for(i=0; i<46; i++)
		asm("nop;");
	if(!real_realloc)
		real_realloc = dlsym(RTLD_NEXT, "realloc");
	return real_realloc(ptr, size);
}

void exit(int status)
{
	static void (*real_exit)(int) = NULL;
	int i;
	for(i=0; i<44; i++)
		asm("nop;");
	if(!real_exit)
		real_exit = dlsym(RTLD_NEXT, "exit");
	return real_exit(status);
}

char *getenv(const char * name)
{
	static char * (*real_getenv)(const char *) = NULL;
	int i;
	for(i=0; i<6; i++)
		asm("nop;");
	if(!real_getenv)
		real_getenv = dlsym(RTLD_NEXT, "getenv");
	return real_getenv(name);
}

int mblen(const char * s, size_t n)
{
	static int (*real_mblen)(const char *, size_t) = NULL;
	int i;
	for(i=0; i<42; i++)
		asm("nop;");
	if(!real_mblen)
		real_mblen = dlsym(RTLD_NEXT, "mblen");
	return real_mblen(s, n);
}

void *memcpy(void * s1, const void * s2, size_t n)
{
	static void * (*real_memcpy)(void *, const void *, size_t) = NULL;
	int i;
	for(i=0; i<32; i++)
		asm("nop;");
	if(!real_memcpy)
		real_memcpy = dlsym(RTLD_NEXT, "memcpy");
	return real_memcpy(s1, s2, n);
}

void *memmove(void * s1, const void * s2, size_t n)
{
	static void * (*real_memmove)(void *, const void *, size_t) = NULL;
	int i;
	for(i=0; i<7; i++)
		asm("nop;");
	if(!real_memmove)
		real_memmove = dlsym(RTLD_NEXT, "memmove");
	return real_memmove(s1, s2, n);
}

char *strcpy(char * s1, const char * s2)
{
	static char * (*real_strcpy)(char *, const char *) = NULL;
	int i;
	for(i=0; i<25; i++)
		asm("nop;");
	if(!real_strcpy)
		real_strcpy = dlsym(RTLD_NEXT, "strcpy");
	return real_strcpy(s1, s2);
}

char *strncpy(char * s1, const char * s2, size_t n)
{
	static char * (*real_strncpy)(char *, const char *, size_t) = NULL;
	int i;
	for(i=0; i<30; i++)
		asm("nop;");
	if(!real_strncpy)
		real_strncpy = dlsym(RTLD_NEXT, "strncpy");
	return real_strncpy(s1, s2, n);
}

int memcmp(const void * s1, const void * s2, size_t n)
{
	static int (*real_memcmp)(const void *, const void *, size_t) = NULL;
	int i;
	for(i=0; i<2; i++)
		asm("nop;");
	if(!real_memcmp)
		real_memcmp = dlsym(RTLD_NEXT, "memcmp");
	return real_memcmp(s1, s2, n);
}

int strcmp(const char * s1, const char * s2)
{
	static int (*real_strcmp)(const char *, const char *) = NULL;
	int i;
	for(i=0; i<44; i++)
		asm("nop;");
	if(!real_strcmp)
		real_strcmp = dlsym(RTLD_NEXT, "strcmp");
	return real_strcmp(s1, s2);
}

int strncmp(const char * s1, const char * s2, size_t n)
{
	static int (*real_strncmp)(const char *, const char *, size_t) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_strncmp)
		real_strncmp = dlsym(RTLD_NEXT, "strncmp");
	return real_strncmp(s1, s2, n);
}

void *memchr(const void * s, int c, size_t n)
{
	static void * (*real_memchr)(const void *, int, size_t) = NULL;
	int i;
	for(i=0; i<28; i++)
		asm("nop;");
	if(!real_memchr)
		real_memchr = dlsym(RTLD_NEXT, "memchr");
	return real_memchr(s, c, n);
}

char *strchr(const char * s, int c)
{
	static char * (*real_strchr)(const char *, int) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_strchr)
		real_strchr = dlsym(RTLD_NEXT, "strchr");
	return real_strchr(s, c);
}

size_t strcspn(const char * s1, const char * s2)
{
	static size_t (*real_strcspn)(const char *, const char *) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_strcspn)
		real_strcspn = dlsym(RTLD_NEXT, "strcspn");
	return real_strcspn(s1, s2);
}

char *strpbrk(const char * s1, const char * s2)
{
	static char * (*real_strpbrk)(const char *, const char *) = NULL;
	int i;
	for(i=0; i<50; i++)
		asm("nop;");
	if(!real_strpbrk)
		real_strpbrk = dlsym(RTLD_NEXT, "strpbrk");
	return real_strpbrk(s1, s2);
}

char *strrchr(const char * s, int c)
{
	static char * (*real_strrchr)(const char *, int) = NULL;
	int i;
	for(i=0; i<5; i++)
		asm("nop;");
	if(!real_strrchr)
		real_strrchr = dlsym(RTLD_NEXT, "strrchr");
	return real_strrchr(s, c);
}

char *strstr(const char * s1, const char * s2)
{
	static char * (*real_strstr)(const char *, const char *) = NULL;
	int i;
	for(i=0; i<5; i++)
		asm("nop;");
	if(!real_strstr)
		real_strstr = dlsym(RTLD_NEXT, "strstr");
	return real_strstr(s1, s2);
}

void *memset(void * s, int c, size_t n)
{
	static void * (*real_memset)(void *, int, size_t) = NULL;
	int i;
	for(i=0; i<42; i++)
		asm("nop;");
	if(!real_memset)
		real_memset = dlsym(RTLD_NEXT, "memset");
	return real_memset(s, c, n);
}

size_t strlen(const char * s)
{
	static size_t (*real_strlen)(const char *) = NULL;
	int i;
	for(i=0; i<50; i++)
		asm("nop;");
	if(!real_strlen)
		real_strlen = dlsym(RTLD_NEXT, "strlen");
	return real_strlen(s);
}

int wctob(wint_t c)
{
	static int (*real_wctob)(wint_t) = NULL;
	int i;
	for(i=0; i<3; i++)
		asm("nop;");
	if(!real_wctob)
		real_wctob = dlsym(RTLD_NEXT, "wctob");
	return real_wctob(c);
}

size_t mbrtowc(wchar_t * pwc, const char * s, size_t n, mbstate_t * ps)
{
	static size_t (*real_mbrtowc)(wchar_t *, const char *, size_t, mbstate_t *) = NULL;
	int i;
	for(i=0; i<31; i++)
		asm("nop;");
	if(!real_mbrtowc)
		real_mbrtowc = dlsym(RTLD_NEXT, "mbrtowc");
	return real_mbrtowc(pwc, s, n, ps);
}
size_t wcrtomb(char * s, wchar_t wc, mbstate_t * ps)
{
	static size_t (*real_wcrtomb)(char *, wchar_t, mbstate_t *) = NULL;
	int i;
	for(i=0; i<20; i++)
		asm("nop;");
	if(!real_wcrtomb)
		real_wcrtomb = dlsym(RTLD_NEXT, "wcrtomb");
	return real_wcrtomb(s, wc, ps);
}

pid_t fork(void )
{
	static pid_t (*real_fork)(void) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_fork)
		real_fork = dlsym(RTLD_NEXT, "fork");
	return real_fork();
}

int close(int fildes)
{
	static int (*real_close)(int) = NULL;
	int i;
	for(i=0; i<20; i++)
		asm("nop;");
	if(!real_close)
		real_close = dlsym(RTLD_NEXT, "close");
	return real_close(fildes);
}

int sigemptyset(sigset_t * set)
{
	static int (*real_sigemptyset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<19; i++)
		asm("nop;");
	if(!real_sigemptyset)
		real_sigemptyset = dlsym(RTLD_NEXT, "sigemptyset");
	return real_sigemptyset(set);
}

uid_t getuid(void )
{
	static uid_t (*real_getuid)(void) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_getuid)
		real_getuid = dlsym(RTLD_NEXT, "getuid");
	return real_getuid();
}

uid_t geteuid(void )
{
	static uid_t (*real_geteuid)(void) = NULL;
	int i;
	for(i=0; i<13; i++)
		asm("nop;");
	if(!real_geteuid)
		real_geteuid = dlsym(RTLD_NEXT, "geteuid");
	return real_geteuid();
}

pid_t getppid(void )
{
	static pid_t (*real_getppid)(void) = NULL;
	int i;
	for(i=0; i<48; i++)
		asm("nop;");
	if(!real_getppid)
		real_getppid = dlsym(RTLD_NEXT, "getppid");
	return real_getppid();
}

gid_t getegid(void )
{
	static gid_t (*real_getegid)(void) = NULL;
	int i;
	for(i=0; i<27; i++)
		asm("nop;");
	if(!real_getegid)
		real_getegid = dlsym(RTLD_NEXT, "getegid");
	return real_getegid();
}

pid_t getpgrp(void )
{
	static pid_t (*real_getpgrp)(void) = NULL;
	int i;
	for(i=0; i<19; i++)
		asm("nop;");
	if(!real_getpgrp)
		real_getpgrp = dlsym(RTLD_NEXT, "getpgrp");
	return real_getpgrp();
}

int gethostname(char * name, size_t len)
{
	static int (*real_gethostname)(char *, size_t) = NULL;
	int i;
	for(i=0; i<34; i++)
		asm("nop;");
	if(!real_gethostname)
		real_gethostname = dlsym(RTLD_NEXT, "gethostname");
	return real_gethostname(name, len);
}

int sigprocmask(int how, const sigset_t * set, sigset_t * oldset)
{
	static int (*real_sigprocmask)(int, const sigset_t *, sigset_t *) = NULL;
	int i;
	for(i=0; i<41; i++)
		asm("nop;");
	if(!real_sigprocmask)
		real_sigprocmask = dlsym(RTLD_NEXT, "sigprocmask");
	return real_sigprocmask(how, set, oldset);
}

int dup2(int fildes, int fildes2)
{
	static int (*real_dup2)(int, int) = NULL;
	int i;
	for(i=0; i<38; i++)
		asm("nop;");
	if(!real_dup2)
		real_dup2 = dlsym(RTLD_NEXT, "dup2");
	return real_dup2(fildes, fildes2);
}

int eaccess(const char * pathname, int mode)
{
	static int (*real_eaccess)(const char *, int) = NULL;
	int i;
	for(i=0; i<19; i++)
		asm("nop;");
	if(!real_eaccess)
		real_eaccess = dlsym(RTLD_NEXT, "eaccess");
	return real_eaccess(pathname, mode);
}

int fcntl(int fd, int cmd)
{
	static int (*real_fcntl)(int, int) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_fcntl)
		real_fcntl = dlsym(RTLD_NEXT, "fcntl");
	return real_fcntl(fd, cmd);
}

int sigaction(int sig, const struct sigaction * act, struct sigaction * oact)
{
	static int (*real_sigaction)(int, const struct sigaction *, struct sigaction *) = NULL;
	int i;
	for(i=0; i<0; i++)
		asm("nop;");
	if(!real_sigaction)
		real_sigaction = dlsym(RTLD_NEXT, "sigaction");
	return real_sigaction(sig, act, oact);
}

int getpagesize(void )
{
	static int (*real_getpagesize)(void) = NULL;
	int i;
	for(i=0; i<43; i++)
		asm("nop;");
	if(!real_getpagesize)
		real_getpagesize = dlsym(RTLD_NEXT, "getpagesize");
	return real_getpagesize();
}

int isatty(int fd)
{
	static int (*real_isatty)(int) = NULL;
	int i;
	for(i=0; i<37; i++)
		asm("nop;");
	if(!real_isatty)
		real_isatty = dlsym(RTLD_NEXT, "isatty");
	return real_isatty(fd);
}

int fileno(FILE * stream)
{
	static int (*real_fileno)(FILE *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_fileno)
		real_fileno = dlsym(RTLD_NEXT, "fileno");
	return real_fileno(stream);
}

int gettimeofday(struct timeval * tv, struct timezone * tz)
{
	static int (*real_gettimeofday)(struct timeval *, struct timezone *) = NULL;
	int i;
	for(i=0; i<28; i++)
		asm("nop;");
	if(!real_gettimeofday)
		real_gettimeofday = dlsym(RTLD_NEXT, "gettimeofday");
	return real_gettimeofday(tv, tz);
}

time_t time(time_t * t)
{
	static time_t (*real_time)(time_t *) = NULL;
	int i;
	for(i=0; i<37; i++)
		asm("nop;");
	if(!real_time)
		real_time = dlsym(RTLD_NEXT, "time");
	return real_time(t);
}

void *sbrk(intptr_t increment)
{
	static void * (*real_sbrk)(intptr_t) = NULL;
	int i;
	for(i=0; i<50; i++)
		asm("nop;");
	if(!real_sbrk)
		real_sbrk = dlsym(RTLD_NEXT, "sbrk");
	return real_sbrk(increment);
}

int sigfillset(sigset_t * set)
{
	static int (*real_sigfillset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<16; i++)
		asm("nop;");
	if(!real_sigfillset)
		real_sigfillset = dlsym(RTLD_NEXT, "sigfillset");
	return real_sigfillset(set);
}

int sigdelset(sigset_t * set, int signum)
{
	static int (*real_sigdelset)(sigset_t *, int) = NULL;
	int i;
	for(i=0; i<24; i++)
		asm("nop;");
	if(!real_sigdelset)
		real_sigdelset = dlsym(RTLD_NEXT, "sigdelset");
	return real_sigdelset(set, signum);
}

ssize_t read(int fd, void * buf, size_t count)
{
	static ssize_t (*real_read)(int, void *, size_t) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_read)
		real_read = dlsym(RTLD_NEXT, "read");
	return real_read(fd, buf, count);
}

int pipe(int fildes[2])
{
	static int (*real_pipe)(int) = NULL;
	int i;
	for(i=0; i<48; i++)
		asm("nop;");
	if(!real_pipe)
		real_pipe = dlsym(RTLD_NEXT, "pipe");
	return real_pipe(fildes[2]);
}

char *textdomain(const char * domainname)
{
	static char * (*real_textdomain)(const char *) = NULL;
	int i;
	for(i=0; i<38; i++)
		asm("nop;");
	if(!real_textdomain)
		real_textdomain = dlsym(RTLD_NEXT, "textdomain");
	return real_textdomain(domainname);
}

DIR *opendir(const char * name)
{
	static DIR * (*real_opendir)(const char *) = NULL;
	int i;
	for(i=0; i<13; i++)
		asm("nop;");
	if(!real_opendir)
		real_opendir = dlsym(RTLD_NEXT, "opendir");
	return real_opendir(name);
}

