#define _GNU_SOURCE
#define GNULIB_NAMESPACE
#define HAVE_GETUID
#define HAVE_GETEUID
#define HAVE_GETGID
#define HAVE_PTHREAD_MUTEXATTR_INIT
#include <dlfcn.h>
#include <unistd.h>
#include <sys/types.h>
#include <stdbool.h>
#include <sys/time.h>
#include <pthread.h>
#include <dirent.h>
#include <stdio.h>
#include <wchar.h>
#include <libintl.h>
#include <signal.h>

int fcntl(int fd, int cmd)
{
	static int (*real_fcntl)(int, int) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_fcntl)
		real_fcntl = dlsym(RTLD_NEXT, "fcntl");
	return real_fcntl(fd, cmd);
}

int sigaction(int sig, const struct sigaction * act, struct sigaction * oact)
{
	static int (*real_sigaction)(int, const struct sigaction *, struct sigaction *) = NULL;
	int i;
	for(i=0; i<0; i++)
		asm("nop;");
	if(!real_sigaction)
		real_sigaction = dlsym(RTLD_NEXT, "sigaction");
	return real_sigaction(sig, act, oact);
}

int getpagesize(void )
{
	static int (*real_getpagesize)(void) = NULL;
	int i;
	for(i=0; i<43; i++)
		asm("nop;");
	if(!real_getpagesize)
		real_getpagesize = dlsym(RTLD_NEXT, "getpagesize");
	return real_getpagesize();
}

int isatty(int fd)
{
	static int (*real_isatty)(int) = NULL;
	int i;
	for(i=0; i<37; i++)
		asm("nop;");
	if(!real_isatty)
		real_isatty = dlsym(RTLD_NEXT, "isatty");
	return real_isatty(fd);
}

int fileno(FILE * stream)
{
	static int (*real_fileno)(FILE *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_fileno)
		real_fileno = dlsym(RTLD_NEXT, "fileno");
	return real_fileno(stream);
}

int gettimeofday(struct timeval * tv, struct timezone * tz)
{
	static int (*real_gettimeofday)(struct timeval *, struct timezone *) = NULL;
	int i;
	for(i=0; i<28; i++)
		asm("nop;");
	if(!real_gettimeofday)
		real_gettimeofday = dlsym(RTLD_NEXT, "gettimeofday");
	return real_gettimeofday(tv, tz);
}

time_t time(time_t * t)
{
	static time_t (*real_time)(time_t *) = NULL;
	int i;
	for(i=0; i<37; i++)
		asm("nop;");
	if(!real_time)
		real_time = dlsym(RTLD_NEXT, "time");
	return real_time(t);
}

void *sbrk(intptr_t increment)
{
	static void * (*real_sbrk)(intptr_t) = NULL;
	int i;
	for(i=0; i<50; i++)
		asm("nop;");
	if(!real_sbrk)
		real_sbrk = dlsym(RTLD_NEXT, "sbrk");
	return real_sbrk(increment);
}

int sigfillset(sigset_t * set)
{
	static int (*real_sigfillset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<16; i++)
		asm("nop;");
	if(!real_sigfillset)
		real_sigfillset = dlsym(RTLD_NEXT, "sigfillset");
	return real_sigfillset(set);
}

int sigdelset(sigset_t * set, int signum)
{
	static int (*real_sigdelset)(sigset_t *, int) = NULL;
	int i;
	for(i=0; i<24; i++)
		asm("nop;");
	if(!real_sigdelset)
		real_sigdelset = dlsym(RTLD_NEXT, "sigdelset");
	return real_sigdelset(set, signum);
}

ssize_t read(int fd, void * buf, size_t count)
{
	static ssize_t (*real_read)(int, void *, size_t) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_read)
		real_read = dlsym(RTLD_NEXT, "read");
	return real_read(fd, buf, count);
}

int pipe(int fildes[2])
{
	static int (*real_pipe)(int) = NULL;
	int i;
	for(i=0; i<48; i++)
		asm("nop;");
	if(!real_pipe)
		real_pipe = dlsym(RTLD_NEXT, "pipe");
	return real_pipe(fildes[2]);
}

char *textdomain(const char * domainname)
{
	static char * (*real_textdomain)(const char *) = NULL;
	int i;
	for(i=0; i<38; i++)
		asm("nop;");
	if(!real_textdomain)
		real_textdomain = dlsym(RTLD_NEXT, "textdomain");
	return real_textdomain(domainname);
}

DIR *opendir(const char * name)
{
	static DIR * (*real_opendir)(const char *) = NULL;
	int i;
	for(i=0; i<13; i++)
		asm("nop;");
	if(!real_opendir)
		real_opendir = dlsym(RTLD_NEXT, "opendir");
	return real_opendir(name);
}

