#define _GNU_SOURCE
#define GNULIB_NAMESPACE
#define HAVE_GETUID
#define HAVE_GETEUID
#define HAVE_GETGID
#define HAVE_PTHREAD_MUTEXATTR_INIT
#include <dlfcn.h>
#include <unistd.h>
#include <sys/types.h>
#include <stdbool.h>
#include "/usr/include/time.h"
#include <pthread.h>
#include <dirent.h>
#include <stdio.h>
#include <wchar.h>
#include <libintl.h>

pid_t fork(void )
{
	static pid_t (*real_fork)(void) = NULL;
	int i;
	for(i=0; i<29; i++)
		asm("nop;");
	if(!real_fork)
		real_fork = dlsym(RTLD_NEXT, "fork");
	return real_fork();
}

long sysconf(int name)
{
	static long (*real_sysconf)(int) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_sysconf)
		real_sysconf = dlsym(RTLD_NEXT, "sysconf");
	return real_sysconf(name);
}

int close(int fildes)
{
	static int (*real_close)(int) = NULL;
	int i;
	for(i=0; i<1; i++)
		asm("nop;");
	if(!real_close)
		real_close = dlsym(RTLD_NEXT, "close");
	return real_close(fildes);
}

int sigemptyset(sigset_t * set)
{
	static int (*real_sigemptyset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_sigemptyset)
		real_sigemptyset = dlsym(RTLD_NEXT, "sigemptyset");
	return real_sigemptyset(set);
}

gid_t getgid(void )
{
	static gid_t (*real_getgid)(void) = NULL;
	int i;
	for(i=0; i<31; i++)
		asm("nop;");
	if(!real_getgid)
		real_getgid = dlsym(RTLD_NEXT, "getgid");
	return real_getgid();
}

uid_t getuid(void )
{
	static uid_t (*real_getuid)(void) = NULL;
	int i;
	for(i=0; i<5; i++)
		asm("nop;");
	if(!real_getuid)
		real_getuid = dlsym(RTLD_NEXT, "getuid");
	return real_getuid();
}

uid_t geteuid(void )
{
	static uid_t (*real_geteuid)(void) = NULL;
	int i;
	for(i=0; i<47; i++)
		asm("nop;");
	if(!real_geteuid)
		real_geteuid = dlsym(RTLD_NEXT, "geteuid");
	return real_geteuid();
}

pid_t getppid(void )
{
	static pid_t (*real_getppid)(void) = NULL;
	int i;
	for(i=0; i<16; i++)
		asm("nop;");
	if(!real_getppid)
		real_getppid = dlsym(RTLD_NEXT, "getppid");
	return real_getppid();
}

gid_t getegid(void )
{
	static gid_t (*real_getegid)(void) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_getegid)
		real_getegid = dlsym(RTLD_NEXT, "getegid");
	return real_getegid();
}

pid_t getpgrp(void )
{
	static pid_t (*real_getpgrp)(void) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_getpgrp)
		real_getpgrp = dlsym(RTLD_NEXT, "getpgrp");
	return real_getpgrp();
}

int gethostname(char * name, size_t len)
{
	static int (*real_gethostname)(char *, size_t) = NULL;
	int i;
	for(i=0; i<20; i++)
		asm("nop;");
	if(!real_gethostname)
		real_gethostname = dlsym(RTLD_NEXT, "gethostname");
	return real_gethostname(name, len);
}

int sigprocmask(int how, const sigset_t * set, sigset_t * oldset)
{
	static int (*real_sigprocmask)(int, const sigset_t *, sigset_t *) = NULL;
	int i;
	for(i=0; i<9; i++)
		asm("nop;");
	if(!real_sigprocmask)
		real_sigprocmask = dlsym(RTLD_NEXT, "sigprocmask");
	return real_sigprocmask(how, set, oldset);
}

int dup2(int fildes, int fildes2)
{
	static int (*real_dup2)(int, int) = NULL;
	int i;
	for(i=0; i<17; i++)
		asm("nop;");
	if(!real_dup2)
		real_dup2 = dlsym(RTLD_NEXT, "dup2");
	return real_dup2(fildes, fildes2);
}

int eaccess(const char * pathname, int mode)
{
	static int (*real_eaccess)(const char *, int) = NULL;
	int i;
	for(i=0; i<13; i++)
		asm("nop;");
	if(!real_eaccess)
		real_eaccess = dlsym(RTLD_NEXT, "eaccess");
	return real_eaccess(pathname, mode);
}

int fcntl(int fd, int cmd)
{
	static int (*real_fcntl)(int, int) = NULL;
	int i;
	for(i=0; i<9; i++)
		asm("nop;");
	if(!real_fcntl)
		real_fcntl = dlsym(RTLD_NEXT, "fcntl");
	return real_fcntl(fd, cmd);
}

int sigaction(int sig, const struct sigaction * act, struct sigaction * oact)
{
	static int (*real_sigaction)(int, const struct sigaction *, struct sigaction *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_sigaction)
		real_sigaction = dlsym(RTLD_NEXT, "sigaction");
	return real_sigaction(sig, act, oact);
}

int getpagesize(void )
{
	static int (*real_getpagesize)(void) = NULL;
	int i;
	for(i=0; i<6; i++)
		asm("nop;");
	if(!real_getpagesize)
		real_getpagesize = dlsym(RTLD_NEXT, "getpagesize");
	return real_getpagesize();
}

int isatty(int fd)
{
	static int (*real_isatty)(int) = NULL;
	int i;
	for(i=0; i<10; i++)
		asm("nop;");
	if(!real_isatty)
		real_isatty = dlsym(RTLD_NEXT, "isatty");
	return real_isatty(fd);
}

int fileno(FILE * stream)
{
	static int (*real_fileno)(FILE *) = NULL;
	int i;
	for(i=0; i<26; i++)
		asm("nop;");
	if(!real_fileno)
		real_fileno = dlsym(RTLD_NEXT, "fileno");
	return real_fileno(stream);
}

int gettimeofday(struct timeval * tv, struct timezone * tz)
{
	static int (*real_gettimeofday)(struct timeval *, struct timezone *) = NULL;
	int i;
	for(i=0; i<25; i++)
		asm("nop;");
	if(!real_gettimeofday)
		real_gettimeofday = dlsym(RTLD_NEXT, "gettimeofday");
	return real_gettimeofday(tv, tz);
}

time_t time(time_t * t)
{
	static time_t (*real_time)(time_t *) = NULL;
	int i;
	for(i=0; i<24; i++)
		asm("nop;");
	if(!real_time)
		real_time = dlsym(RTLD_NEXT, "time");
	return real_time(t);
}

void *sbrk(intptr_t increment)
{
	static void * (*real_sbrk)(intptr_t) = NULL;
	int i;
	for(i=0; i<20; i++)
		asm("nop;");
	if(!real_sbrk)
		real_sbrk = dlsym(RTLD_NEXT, "sbrk");
	return real_sbrk(increment);
}

int sigfillset(sigset_t * set)
{
	static int (*real_sigfillset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<18; i++)
		asm("nop;");
	if(!real_sigfillset)
		real_sigfillset = dlsym(RTLD_NEXT, "sigfillset");
	return real_sigfillset(set);
}

int sigdelset(sigset_t * set, int signum)
{
	static int (*real_sigdelset)(sigset_t *, int) = NULL;
	int i;
	for(i=0; i<12; i++)
		asm("nop;");
	if(!real_sigdelset)
		real_sigdelset = dlsym(RTLD_NEXT, "sigdelset");
	return real_sigdelset(set, signum);
}

ssize_t read(int fd, void * buf, size_t count)
{
	static ssize_t (*real_read)(int, void *, size_t) = NULL;
	int i;
	for(i=0; i<19; i++)
		asm("nop;");
	if(!real_read)
		real_read = dlsym(RTLD_NEXT, "read");
	return real_read(fd, buf, count);
}

int pipe(int fildes[2])
{
	static int (*real_pipe)(int) = NULL;
	int i;
	for(i=0; i<39; i++)
		asm("nop;");
	if(!real_pipe)
		real_pipe = dlsym(RTLD_NEXT, "pipe");
	return real_pipe(fildes[2]);
}

char *textdomain(const char * domainname)
{
	static char * (*real_textdomain)(const char *) = NULL;
	int i;
	for(i=0; i<29; i++)
		asm("nop;");
	if(!real_textdomain)
		real_textdomain = dlsym(RTLD_NEXT, "textdomain");
	return real_textdomain(domainname);
}

DIR *opendir(const char * name)
{
	static DIR * (*real_opendir)(const char *) = NULL;
	int i;
	for(i=0; i<17; i++)
		asm("nop;");
	if(!real_opendir)
		real_opendir = dlsym(RTLD_NEXT, "opendir");
	return real_opendir(name);
}

