#define _GNU_SOURCE
#define GNULIB_NAMESPACE
#define HAVE_GETUID
#define HAVE_GETEUID
#define HAVE_GETGID
#define HAVE_PTHREAD_MUTEXATTR_INIT
#include <dlfcn.h>
#include <unistd.h>
#include <sys/types.h>
#include <stdbool.h>
#include "/usr/include/time.h"
#include <pthread.h>
#include <dirent.h>
#include <stdio.h>
#include <wchar.h>
#include <libintl.h>

pid_t fork(void )
{
	static pid_t (*real_fork)(void) = NULL;
	int i;
	for(i=0; i<29; i++)
		asm("nop;");
	if(!real_fork)
		real_fork = dlsym(RTLD_NEXT, "fork");
	return real_fork();
}

long sysconf(int name)
{
	static long (*real_sysconf)(int) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_sysconf)
		real_sysconf = dlsym(RTLD_NEXT, "sysconf");
	return real_sysconf(name);
}

int close(int fildes)
{
	static int (*real_close)(int) = NULL;
	int i;
	for(i=0; i<1; i++)
		asm("nop;");
	if(!real_close)
		real_close = dlsym(RTLD_NEXT, "close");
	return real_close(fildes);
}

int sigemptyset(sigset_t * set)
{
	static int (*real_sigemptyset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_sigemptyset)
		real_sigemptyset = dlsym(RTLD_NEXT, "sigemptyset");
	return real_sigemptyset(set);
}

gid_t getgid(void )
{
	static gid_t (*real_getgid)(void) = NULL;
	int i;
	for(i=0; i<31; i++)
		asm("nop;");
	if(!real_getgid)
		real_getgid = dlsym(RTLD_NEXT, "getgid");
	return real_getgid();
}

uid_t getuid(void )
{
	static uid_t (*real_getuid)(void) = NULL;
	int i;
	for(i=0; i<5; i++)
		asm("nop;");
	if(!real_getuid)
		real_getuid = dlsym(RTLD_NEXT, "getuid");
	return real_getuid();
}
