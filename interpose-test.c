#define _GNU_SOURCE
#define GNULIB_NAMESPACE
#define HAVE_GETUID
#define HAVE_GETEUID
#define HAVE_GETGID
#define HAVE_PTHREAD_MUTEXATTR_INIT
#include <dlfcn.h>
#include <unistd.h>
#include <sys/types.h>
#include <stdbool.h>
#include "/usr/include/time.h"
#include <pthread.h>
#include <dirent.h>
#include <stdio.h>
#include <wchar.h>
#include <libintl.h>

pid_t fork(void )
{
	static pid_t (*real_fork)(void) = NULL;
	int i;
	for(i=0; i<29; i++)
		asm("nop;");
	if(!real_fork)
		real_fork = dlsym(RTLD_NEXT, "fork");
	return real_fork();
}

long sysconf(int name)
{
	static long (*real_sysconf)(int) = NULL;
	int i;
	for(i=0; i<49; i++)
		asm("nop;");
	if(!real_sysconf)
		real_sysconf = dlsym(RTLD_NEXT, "sysconf");
	return real_sysconf(name);
}

int close(int fildes)
{
	static int (*real_close)(int) = NULL;
	int i;
	for(i=0; i<1; i++)
		asm("nop;");
	if(!real_close)
		real_close = dlsym(RTLD_NEXT, "close");
	return real_close(fildes);
}

int sigemptyset(sigset_t * set)
{
	static int (*real_sigemptyset)(sigset_t *) = NULL;
	int i;
	for(i=0; i<40; i++)
		asm("nop;");
	if(!real_sigemptyset)
		real_sigemptyset = dlsym(RTLD_NEXT, "sigemptyset");
	return real_sigemptyset(set);
}

gid_t getgid(void )
{
	static gid_t (*real_getgid)(void) = NULL;
	int i;
	for(i=0; i<31; i++)
		asm("nop;");
	if(!real_getgid)
		real_getgid = dlsym(RTLD_NEXT, "getgid");
	return real_getgid();
}

uid_t getuid(void )
{
	static uid_t (*real_getuid)(void) = NULL;
	int i;
	for(i=0; i<5; i++)
		asm("nop;");
	if(!real_getuid)
		real_getuid = dlsym(RTLD_NEXT, "getuid");
	return real_getuid();
}

uid_t geteuid(void )
{
	static uid_t (*real_geteuid)(void) = NULL;
	int i;
	for(i=0; i<47; i++)
		asm("nop;");
	if(!real_geteuid)
		real_geteuid = dlsym(RTLD_NEXT, "geteuid");
	return real_geteuid();
}

pid_t getppid(void )
{
	static pid_t (*real_getppid)(void) = NULL;
	int i;
	for(i=0; i<16; i++)
		asm("nop;");
	if(!real_getppid)
		real_getppid = dlsym(RTLD_NEXT, "getppid");
	return real_getppid();
}

gid_t getegid(void )
{
	static gid_t (*real_getegid)(void) = NULL;
	int i;
	for(i=0; i<22; i++)
		asm("nop;");
	if(!real_getegid)
		real_getegid = dlsym(RTLD_NEXT, "getegid");
	return real_getegid();
}

pid_t getpgrp(void )
{
	static pid_t (*real_getpgrp)(void) = NULL;
	int i;
	for(i=0; i<21; i++)
		asm("nop;");
	if(!real_getpgrp)
		real_getpgrp = dlsym(RTLD_NEXT, "getpgrp");
	return real_getpgrp();
}

int gethostname(char * name, size_t len)
{
	static int (*real_gethostname)(char *, size_t) = NULL;
	int i;
	for(i=0; i<20; i++)
		asm("nop;");
	if(!real_gethostname)
		real_gethostname = dlsym(RTLD_NEXT, "gethostname");
	return real_gethostname(name, len);
}

int sigprocmask(int how, const sigset_t * set, sigset_t * oldset)
{
	static int (*real_sigprocmask)(int, const sigset_t *, sigset_t *) = NULL;
	int i;
	for(i=0; i<9; i++)
		asm("nop;");
	if(!real_sigprocmask)
		real_sigprocmask = dlsym(RTLD_NEXT, "sigprocmask");
	return real_sigprocmask(how, set, oldset);
}
